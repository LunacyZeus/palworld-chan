var f=(c,s,e)=>new Promise((r,o)=>{var _=a=>{try{l(e.next(a))}catch(n){o(n)}},u=a=>{try{l(e.throw(a))}catch(n){o(n)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(_,u);l((e=e.apply(c,s)).next())});import{d as m,ay as B,r as i,l as C,ai as v,y as h,F as E,G,U as b,D as p,J as A,aj as I,at as M,au as w,Y as D,az as F,b as N}from"./9a74f89d.js";import{_ as T}from"./0ee26181.js";import{b as z}from"./0b54f966.js";const R=["id"],U=["id"],$={key:0,class:"line-content"},j={key:1},q=m({__name:"gliding-log",props:{id:String,logCache:{type:Array,require:!0,default:()=>[]},status:String,capacity:Number},setup(c){const s=c;s.logCache;const{id:e,logCache:r,status:o,capacity:_}=B(s),u=i(1),l=i(-1),a=i(!0),n=i([]),y=C(()=>{a.value;let t=s.capacity*u.value,g=l.value-t+1;return g<0&&(g=0),n.value.slice(g,l.value+1)}),L=()=>{let t=document.getElementById(s.id);t&&(t.scrollTop=t.scrollHeight)},x=(t,g)=>{if(n.value.length,t){let d=t.splice(0,g).map((k,S)=>({line:k,index:n.value.length+S}));n.value=n.value.concat(d)}};return v(n,()=>{a.value&&I(()=>{L()}),l.value=n.value.length-1}),v(()=>s.logCache,t=>{x(t,t==null?void 0:t.length)},{deep:!0}),(t,g)=>(p(),h("div",{id:b(e),class:"gliding-log"},[(p(!0),h(E,null,G(y.value,d=>(p(),h("div",{id:"log-line-"+d.index,key:d.index},[d.line?(p(),h("div",$,A(d.line),1)):(p(),h("br",j))],8,U))),128))],8,R))}});const H=T(q,[["__scopeId","data-v-331d9f24"]]),J=M({id:"serverConf",state:()=>({result:"",error:"",logCache:null}),getters:{getResult(){return this.result||""},getError(){return this.error||""},getLogCache(){return this.logCache||{}}},actions:{setLogCache(c){this.logCache=c},GetData(){return f(this,null,function*(){return new Promise((c,s)=>{z().then(e=>{const r=e.message||null;(e.code||404)==200?this.setLogCache(e.result||{}):this.error=r,c(e)}).catch(e=>{this.error=e,s(e)})})})}}});function P(){return J(w)}const V={id:"app"},Q=m({__name:"index",setup(c){const s=i(""),e=i(""),r=i(""),o=P();C(()=>e.value==="running");const _=()=>f(this,null,function*(){if(yield o.GetData(),o.getLogCache){if(""+o.getLogCache.lines,r.value!=o.getLogCache.lastModifiedAt){r.value,o.getLogCache.lastModifiedAt,r.value=o.getLogCache.lastModifiedAt;let l=o.getLogCache.lines;s.value=l}}else o.getError&&console.error("Failed to GetLog:",o.getError);e.value="running"});let u=null;return D(()=>{_(),u=setInterval(()=>{_()},1e4)}),F(()=>{clearInterval(Number(u))}),(l,a)=>(p(),h("div",V,[N(H,{id:"log",logCache:s.value,status:e.value,capacity:500},null,8,["logCache","status"])]))}});export{Q as default};
